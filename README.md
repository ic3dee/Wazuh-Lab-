
[![en](https://img.shields.io/badge/lang-RU-red.svg)](https://github.com/LITHUM1/Wazuh-Home-Lab/blob/main/README.RU.md)

# WAZUH Home Lab

### Overview
This is a home lab setup for WAZUH Stack, a Security Information and Event Management (SIEM) system, utilizing the WAZUH Web Portal and a Kali Linux virtual machine (VM).

### Tools We Will Use in Our Home Lab:
1. VMware
2. WAZUH
3. Kali Linux VM

---

### Environment Setup: Deploying Wazuh Server VM

To get started, we’ll deploy the Wazuh Server locally on VMware. For more details, refer to the [documentation](https://documentation.wazuh.com/current/deployment-options/virtual-machine/virtual-machine.html).

1. **Download the Wazuh Server OVA Image**:
   ![Download](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/Download-Wazuh-server-image.png)

2. **Launch the Wazuh Server on VMware**:
   After downloading and launching the image in VMware, wait a few minutes for it to initialize.

3. **Log In and Verify Deployment**:
   Once the server starts, log in using the default credentials. The terminal below confirms the successful deployment of Wazuh:
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/up-and-running.png)

4. **Access the Wazuh Web Portal**:
   You can find the machine's IP by running the command `ip a`. Enter this IP into your browser to access the portal.
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/Wazuh-portal.png)

   The default credentials are `admin:admin`. Below is the Wazuh main dashboard.

---

### Deploying Wazuh Agents

Now we need two additional VMs: one running Windows and one running Kali Linux.

1. **Install Wazuh Agents**:
   Install the Wazuh agent on both VMs to collect telemetry and gain visibility into these hosts.
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/Win-Agent.png)
   (https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/Kali-agent.png)

2. **Verify Agent Deployment**:
   As shown below, both Wazuh agents are up and running:
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/Wazuh-agents.png)

---

### Stress Testing Our Agents

With both Wazuh agents deployed and reporting to the Wazuh Server, let's trigger a potential malicious alert using manual testing.

#### Manual Testing

1. **Test by Installing Metasploit Framework**:
   - On the Windows VM, install the Metasploit Framework.
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/installing-metasploit-windows.png)

   - On the Kali VM, perform a port scan using Metasploit.
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/metasploit-kali.png)
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/port-scanner.png)

   Wazuh detects activity from either the Metasploit installation on Windows or the port scan from Kali VM. However, no risk events were generated from these actions.

2. **Try a More Noticeable Test**:
   - On the Windows VM, create a new user and add it to the local Administrators group using the following commands:
     ```shell
     net user <username> <password> /add
     net localgroup Administrator <username> /add
     ```
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/adding-user.png)

   - This action should trigger a notification, as shown below:
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/report-Wazuh.png)

   After clicking on the “2”, you can see the logs in the SIEM module, quickly identifying the affected agent, the MITRE ATT&CK technique, and a brief description of the activity.

---

### Automated Testing

Now that we’ve done some manual testing, let's automate the process using an Endpoint Detection and Response (EDR) testing script, which will perform several MITRE ATT&CK techniques. The payload used will be the Windows calculator.

1. **Run the EDR Testing Script**:
   - The script, created by op7ic, can be found online. Running the script opens `calc.exe`.
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/cal-script.png)

   - After unzipping the file, run `runtests.bat`. About 15 minutes into the process, Windows Defender will start generating alerts, and the `calc.exe` payload will continue appearing on the desktop.

2. **Monitor the Dashboard**:
   - The MITRE ATT&CK dashboard shows a significant amount of activity generated by the script.
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/wazuh-mitre-attack.png)

   - Although no high-severity alerts were triggered, the Wazuh MITRE ATT&CK dashboard captures detailed activity.

   - In the “Top tactics” pie chart, click on “Persistence” to enter the SIEM query editor. Here, you can apply additional filters to drill down or reduce noise.
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/event-t1078.png)

   - Expanding the results shows an event log indicating that a new service was created.
   ![](https://raw.githubusercontent.com//LITHUM1/Wazuh-Home-Lab/main/Assets/script.png)

This concludes our simple Home Lab setup using Wazuh. This environment allows you to explore security monitoring, incident response, and SIEM capabilities in a controlled, hands-on setting.




















